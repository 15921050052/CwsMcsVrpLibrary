<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Clarke and Wright with Monte Carlo Simulation Library: RandCWS.java Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="../../namespaces.html"><span>Packages</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>RandCWS.java</h1><a href="../../d2/d8a/_rand_c_w_s_8java.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* </span>
<a name="l00002"></a>00002 <span class="comment">        File is part of CwsMcsLib.</span>
<a name="l00003"></a>00003 <span class="comment"></span>
<a name="l00004"></a>00004 <span class="comment">    CwsMcsLib is free software: you can redistribute it and/or modify</span>
<a name="l00005"></a>00005 <span class="comment">    it under the terms of the GNU General Public License as published by</span>
<a name="l00006"></a>00006 <span class="comment">    the Free Software Foundation, GPLv2.</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">    CwsMcsLib is distributed in the hope that it will be useful,</span>
<a name="l00009"></a>00009 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00010"></a>00010 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00011"></a>00011 <span class="comment">    GNU General Public License for more details.</span>
<a name="l00012"></a>00012 <span class="comment"></span>
<a name="l00013"></a>00013 <span class="comment">    You should have received a copy of the GNU General Public License</span>
<a name="l00014"></a>00014 <span class="comment">    along with CwsMcsLib.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00015"></a>00015 <span class="comment"> */</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="keyword">package </span>srgcwscs;
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="keyword">import</span> java.util.ArrayList;
<a name="l00021"></a>00021 <span class="keyword">import</span> java.util.Collections;
<a name="l00022"></a>00022 
<a name="l00038"></a><a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html">00038</a> <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html" title="This class encapsulates the Randomized Generalized Clarke &amp;amp; Wright Savings heuristic...">RandCWS</a>
<a name="l00039"></a>00039 {
<a name="l00043"></a><a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a3f7c99984dba7e69a130aa27e6de4967">00043</a>     <span class="keyword">private</span> <a class="code" href="../../d4/d46/classsrgcwscs_1_1_inputs.html" title="This class represents the basic inputs for a VRP instance, a set of nodes, edges...">Inputs</a> <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a3f7c99984dba7e69a130aa27e6de4967" title="Inputs a representation of the different components of the problem, nodes, edges...">inputs</a>;
<a name="l00044"></a>00044     
<a name="l00048"></a><a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a33ab95db9e1b16e5241fe3e60076576d">00048</a>     <span class="keyword">private</span> <a class="code" href="../../db/d24/classsrgcwscs_1_1_test.html" title="This class represents a test to be run. A test has a set of properties related to...">Test</a> <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a33ab95db9e1b16e5241fe3e60076576d" title="Set of characteristics for the test to be run. InstanceName, Constraints, Maximiun...">aTest</a>;
<a name="l00049"></a>00049     
<a name="l00053"></a><a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a98fd57138924027e8996f9f43f1465d6">00053</a>     <span class="keyword">private</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a98fd57138924027e8996f9f43f1465d6" title="Number of edges.">nEdges</a>;
<a name="l00054"></a>00054     
<a name="l00058"></a><a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a69e501353cddf8bda43fc39ab1022852">00058</a>     <span class="keyword">private</span> <a class="code" href="../../db/dbc/classsrgcwscs_1_1_randomness.html" title="This class manages the random behavior (Monte Carlo Simulation) of the library.">Randomness</a> <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a69e501353cddf8bda43fc39ab1022852" title="Randomness instance.">random</a>;
<a name="l00059"></a>00059     
<a name="l00063"></a><a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a61dc304163be18c43606968886027811">00063</a>     <span class="keyword">private</span> <span class="keywordtype">int</span>[] <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a61dc304163be18c43606968886027811" title="Array for randomize savings list.">positions</a>; <span class="comment">// array of randomly selected positions </span>
<a name="l00064"></a>00064     
<a name="l00068"></a><a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#afe3ec93d1b13d9cd299912ed49c39b69">00068</a>     <span class="keyword">private</span> <a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html" title="This class represents a node in the VRP. A node could be a customer (delivery point)...">Node</a>[] <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#afe3ec93d1b13d9cd299912ed49c39b69" title="Array of nodes.">nodes</a>;
<a name="l00069"></a>00069     
<a name="l00073"></a><a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#afd762923a3a8acb4a4663f74abedad4b">00073</a>     <span class="keyword">private</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#afd762923a3a8acb4a4663f74abedad4b" title="Vehicle Capacity.">vCap</a>;
<a name="l00074"></a>00074     
<a name="l00085"></a><a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a273dcaf9c8f6b4ec3d53df5ad2231aae">00085</a>     <span class="keyword">public</span> <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a273dcaf9c8f6b4ec3d53df5ad2231aae" title="RandCWS Constructor.">RandCWS</a>(<a class="code" href="../../db/d24/classsrgcwscs_1_1_test.html" title="This class represents a test to be run. A test has a set of properties related to...">Test</a> test, <a class="code" href="../../d4/d46/classsrgcwscs_1_1_inputs.html" title="This class represents the basic inputs for a VRP instance, a set of nodes, edges...">Inputs</a> varInputs)
<a name="l00086"></a>00086     {
<a name="l00087"></a>00087         <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a3f7c99984dba7e69a130aa27e6de4967" title="Inputs a representation of the different components of the problem, nodes, edges...">inputs</a> = varInputs;
<a name="l00088"></a>00088         <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a33ab95db9e1b16e5241fe3e60076576d" title="Set of characteristics for the test to be run. InstanceName, Constraints, Maximiun...">aTest</a> = test;
<a name="l00089"></a>00089         <span class="keywordtype">int</span> n = <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a3f7c99984dba7e69a130aa27e6de4967" title="Inputs a representation of the different components of the problem, nodes, edges...">inputs</a>.<a class="code" href="../../d4/d46/classsrgcwscs_1_1_inputs.html#a8133e04b75f3180788f227b4fce95f04" title="Gets an array of nodes corresponding to the customers of the problem.">getNodeList</a>().length;
<a name="l00090"></a>00090         <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#afd762923a3a8acb4a4663f74abedad4b" title="Vehicle Capacity.">vCap</a> = <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a3f7c99984dba7e69a130aa27e6de4967" title="Inputs a representation of the different components of the problem, nodes, edges...">inputs</a>.<a class="code" href="../../d4/d46/classsrgcwscs_1_1_inputs.html#aaf4239bef28ba35b08a2f4fe678599f2" title="Gets a vehicle stored in a given position of the array list of available vehicles...">getVehicle</a>(0).<a class="code" href="../../d2/d00/classsrgcwscs_1_1_vehicle.html#ae05dda2b37c525ae80bc761f88a52d28" title="Gets vehicle capacity.">getVcap</a>();
<a name="l00091"></a>00091 
<a name="l00092"></a>00092         <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a98fd57138924027e8996f9f43f1465d6" title="Number of edges.">nEdges</a> = (n - 1) * (n - 2) / 2; <span class="comment">// The depot is not considered</span>
<a name="l00093"></a>00093         <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a69e501353cddf8bda43fc39ab1022852" title="Randomness instance.">random</a> = <span class="keyword">new</span> <a class="code" href="../../db/dbc/classsrgcwscs_1_1_randomness.html" title="This class manages the random behavior (Monte Carlo Simulation) of the library.">Randomness</a>(<a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a33ab95db9e1b16e5241fe3e60076576d" title="Set of characteristics for the test to be run. InstanceName, Constraints, Maximiun...">aTest</a>, <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a3f7c99984dba7e69a130aa27e6de4967" title="Inputs a representation of the different components of the problem, nodes, edges...">inputs</a>);
<a name="l00094"></a>00094         <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a61dc304163be18c43606968886027811" title="Array for randomize savings list.">positions</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a98fd57138924027e8996f9f43f1465d6" title="Number of edges.">nEdges</a>];
<a name="l00095"></a>00095         <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#afe3ec93d1b13d9cd299912ed49c39b69" title="Array of nodes.">nodes</a> = <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a3f7c99984dba7e69a130aa27e6de4967" title="Inputs a representation of the different components of the problem, nodes, edges...">inputs</a>.<a class="code" href="../../d4/d46/classsrgcwscs_1_1_inputs.html#a8133e04b75f3180788f227b4fce95f04" title="Gets an array of nodes corresponding to the customers of the problem.">getNodeList</a>();  
<a name="l00096"></a>00096     }
<a name="l00097"></a>00097 
<a name="l00108"></a><a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#af32f2c24de91a3e250fb9a0953d40adf">00108</a>     <span class="keyword">public</span> <a class="code" href="../../d9/dfd/classsrgcwscs_1_1_solution.html" title="This class represents a solution (array of routes) of a VRP instance.">Solution</a> <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#af32f2c24de91a3e250fb9a0953d40adf" title="Core method to solve the VRP according to a given characteristics, with a set of...">solve</a>(<a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a>[] effList, <span class="keywordtype">boolean</span> useRandomSelection)
<a name="l00109"></a>00109     {  
<a name="l00110"></a>00110         <span class="comment">// Depot is always node 0 with (x,y) = (0,0) and demand = 0</span>
<a name="l00111"></a>00111         <a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html" title="This class represents a node in the VRP. A node could be a customer (delivery point)...">Node</a> depot = <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#afe3ec93d1b13d9cd299912ed49c39b69" title="Array of nodes.">nodes</a>[0];
<a name="l00112"></a>00112 
<a name="l00113"></a>00113         <span class="comment">// 1. CONSTRUCT THE CWS INITIAL (DUMMY) SOLUTION</span>
<a name="l00114"></a>00114         <a class="code" href="../../d9/dfd/classsrgcwscs_1_1_solution.html" title="This class represents a solution (array of routes) of a VRP instance.">Solution</a> currentSol = <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a9d31e2c7ef8b15aa1a52623107a38b6b" title="Constructs the CWS initial dummy Solution.">getDummySolution</a>(<a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#afe3ec93d1b13d9cd299912ed49c39b69" title="Array of nodes.">nodes</a>);
<a name="l00115"></a>00115 
<a name="l00116"></a>00116         <span class="comment">// 2. PERFORM THE EDGE-SELECTION &amp; ROUTING-MERGING ITERATIVE PROCESS</span>
<a name="l00117"></a>00117         <span class="comment">// This process is a randomization of the corresponding CWS process</span>
<a name="l00118"></a>00118         <span class="comment">// Calculate the array of randomly selected positions of edges in effList</span>
<a name="l00119"></a>00119         <span class="keywordflow">if</span> (useRandomSelection == <span class="keyword">false</span>) <span class="comment">// classical Clarke &amp; Wright solution</span>
<a name="l00120"></a>00120         {
<a name="l00121"></a>00121             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a98fd57138924027e8996f9f43f1465d6" title="Number of edges.">nEdges</a>; i++)
<a name="l00122"></a>00122             {
<a name="l00123"></a>00123                 <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a61dc304163be18c43606968886027811" title="Array for randomize savings list.">positions</a>[i] = i; 
<a name="l00124"></a>00124             }
<a name="l00125"></a>00125         }
<a name="l00126"></a>00126         <span class="keywordflow">else</span>
<a name="l00127"></a>00127         {
<a name="l00128"></a>00128                 <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a61dc304163be18c43606968886027811" title="Array for randomize savings list.">positions</a> = <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a69e501353cddf8bda43fc39ab1022852" title="Randomness instance.">random</a>.<a class="code" href="../../db/dbc/classsrgcwscs_1_1_randomness.html#a473b073cd83b0090ca98aa997dc9becd" title="Calculates a new savings edge order according to a randomization bias.It uses Lecuyer...">calcPositionsArrayFast</a>();<span class="comment">// Randomized Clarke &amp; Wright solution</span>
<a name="l00129"></a>00129         }
<a name="l00130"></a>00130         
<a name="l00131"></a>00131         this.<a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a7bcaff62665d71db34667500868cba93" title="Performs the edge selection and the route merging.">edgeSelectionRoutingMerging</a>(depot,<a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a61dc304163be18c43606968886027811" title="Array for randomize savings list.">positions</a>, effList,<a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a33ab95db9e1b16e5241fe3e60076576d" title="Set of characteristics for the test to be run. InstanceName, Constraints, Maximiun...">aTest</a>, currentSol);
<a name="l00132"></a>00132 
<a name="l00133"></a>00133         <span class="comment">/***************************************************************************</span>
<a name="l00134"></a>00134 <span class="comment">         * 4. SET THE SOLUTION COSTS AND RETURN IT</span>
<a name="l00135"></a>00135 <span class="comment">         ***************************************************************************/</span>
<a name="l00136"></a>00136         <span class="comment">// 4.1. Reset the solution costs</span>
<a name="l00137"></a>00137         currentSol.<a class="code" href="../../d9/dfd/classsrgcwscs_1_1_solution.html#a07667f3835b551ad52fe5ce1a0ebc57b" title="Update the costs for the global solution.">setCosts</a>(0);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139         <span class="comment">// 4.2. Calculate solutions costs</span>
<a name="l00140"></a>00140         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; currentSol.<a class="code" href="../../d9/dfd/classsrgcwscs_1_1_solution.html#ad1eb86c5a8e80359c172a4999c483521" title="Gets the array list of routes for the global solution.">getRoutes</a>().size(); i++) {
<a name="l00141"></a>00141             currentSol.<a class="code" href="../../d9/dfd/classsrgcwscs_1_1_solution.html#a38510d99d0f518df6541c8589f9589dd" title="Adds a given route costs to the global solution cost.">addCosts</a>(currentSol.<a class="code" href="../../d9/dfd/classsrgcwscs_1_1_solution.html#ad1eb86c5a8e80359c172a4999c483521" title="Gets the array list of routes for the global solution.">getRoutes</a>().get(i));
<a name="l00142"></a>00142         }
<a name="l00143"></a>00143 
<a name="l00144"></a>00144         <span class="keywordflow">return</span> currentSol;
<a name="l00145"></a>00145     }
<a name="l00146"></a>00146     
<a name="l00156"></a><a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a9d31e2c7ef8b15aa1a52623107a38b6b">00156</a>     <span class="keyword">public</span> <a class="code" href="../../d9/dfd/classsrgcwscs_1_1_solution.html" title="This class represents a solution (array of routes) of a VRP instance.">Solution</a> <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a9d31e2c7ef8b15aa1a52623107a38b6b" title="Constructs the CWS initial dummy Solution.">getDummySolution</a>(<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html" title="This class represents a node in the VRP. A node could be a customer (delivery point)...">Node</a> [] nodeSet) 
<a name="l00157"></a>00157     {
<a name="l00158"></a>00158         <a class="code" href="../../d9/dfd/classsrgcwscs_1_1_solution.html" title="This class represents a solution (array of routes) of a VRP instance.">Solution</a> dummySolution = <span class="keyword">new</span> <a class="code" href="../../d9/dfd/classsrgcwscs_1_1_solution.html" title="This class represents a solution (array of routes) of a VRP instance.">Solution</a>();
<a name="l00159"></a>00159 
<a name="l00160"></a>00160         <a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html" title="This class represents a node in the VRP. A node could be a customer (delivery point)...">Node</a> depot = nodeSet[0];
<a name="l00161"></a>00161         
<a name="l00162"></a>00162         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 1; i &lt; nodeSet.length; i++ ) <span class="comment">// don&#39;t consider i = 0 (depot)</span>
<a name="l00163"></a>00163         {
<a name="l00164"></a>00164                 <span class="comment">// 1.1. Create diEdge and idEdge (and set corresponding costs)</span>
<a name="l00165"></a>00165                 <a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html" title="This class represents a node in the VRP. A node could be a customer (delivery point)...">Node</a> iNode = nodeSet[i];
<a name="l00166"></a>00166                 <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a> diEdge = <span class="keyword">new</span> <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a>(depot, iNode);
<a name="l00167"></a>00167                 <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a> idEdge = <span class="keyword">new</span> <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a>(iNode, depot);
<a name="l00168"></a>00168 
<a name="l00169"></a>00169                 <span class="comment">// 1.2. Create didRoute (and set corresponding total costs and demand)</span>
<a name="l00170"></a>00170                 <a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html" title="This class represents a route (array of edges) of a VRP instance.">Route</a> didRoute = <span class="keyword">new</span> <a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html" title="This class represents a route (array of edges) of a VRP instance.">Route</a>();
<a name="l00171"></a>00171                 didRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#aae3669c12cbb8e896b444e66928a7b32" title="Adds a new edge to he route.">addEdge</a>(diEdge);
<a name="l00172"></a>00172                 didRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#af01e70b1d49f730cd34fc2cb6817b104" title="add Edge demand to the total route demand">addDemand</a>(diEdge);
<a name="l00173"></a>00173                 didRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#a85bf0163875818ca04db252cbdad766d" title="Updates route cost add an edge cost.">addCosts</a>(diEdge);
<a name="l00174"></a>00174                 didRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#aae3669c12cbb8e896b444e66928a7b32" title="Adds a new edge to he route.">addEdge</a>(idEdge);
<a name="l00175"></a>00175                 didRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#a85bf0163875818ca04db252cbdad766d" title="Updates route cost add an edge cost.">addCosts</a>(idEdge);
<a name="l00176"></a>00176         
<a name="l00177"></a>00177                 <span class="comment">// 1.3. Update iNode properties</span>
<a name="l00178"></a>00178                 iNode.<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html#a32b8133c3d39f06e2f76cf10a5b1b43f" title="Updates route identification associated to the node.">setInRoute</a>(didRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#a9dcc9ef4ad8b28571f395821fcd1a901" title="Get route identification.">getId</a>()); <span class="comment">// save route to which node belongs</span>
<a name="l00179"></a>00179                 iNode.<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html#af84328552840115a9c89f2e8864eeabe" title="Updates the nodes status in the route.">setIsInterior</a>(<span class="keyword">false</span>); <span class="comment">// node is directly connected to depot</span>
<a name="l00180"></a>00180                 iNode.<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html#a5c484c1e76a4a1d327dc2d6d2f9e5719" title="Updates the route instance associated to the node.">setRoute</a>(didRoute);
<a name="l00181"></a>00181                 
<a name="l00182"></a>00182                 <span class="comment">// 1.4. Add didRoute to current solution</span>
<a name="l00183"></a>00183                 dummySolution.<a class="code" href="../../d9/dfd/classsrgcwscs_1_1_solution.html#a2f8bc5efed22aac38afe80b9bb22b206" title="Adds a new route to the solution.">addRoute</a>(didRoute);
<a name="l00184"></a>00184                 dummySolution.<a class="code" href="../../d9/dfd/classsrgcwscs_1_1_solution.html#a38510d99d0f518df6541c8589f9589dd" title="Adds a given route costs to the global solution cost.">addCosts</a>(didRoute);
<a name="l00185"></a>00185                 
<a name="l00186"></a>00186         }
<a name="l00187"></a>00187         <span class="keywordflow">return</span> dummySolution;
<a name="l00188"></a>00188     }
<a name="l00189"></a>00189     
<a name="l00205"></a><a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a7bcaff62665d71db34667500868cba93">00205</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a7bcaff62665d71db34667500868cba93" title="Performs the edge selection and the route merging.">edgeSelectionRoutingMerging</a>(<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html" title="This class represents a node in the VRP. A node could be a customer (delivery point)...">Node</a> depot,<span class="keywordtype">int</span> [] <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a61dc304163be18c43606968886027811" title="Array for randomize savings list.">positions</a>, <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a>[] effList,<a class="code" href="../../db/d24/classsrgcwscs_1_1_test.html" title="This class represents a test to be run. A test has a set of properties related to...">Test</a> test, <a class="code" href="../../d9/dfd/classsrgcwscs_1_1_solution.html" title="This class represents a solution (array of routes) of a VRP instance.">Solution</a> aSolution) 
<a name="l00206"></a>00206     {
<a name="l00207"></a>00207         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = positions.length - 1; i &gt; 0; i-- )
<a name="l00208"></a>00208         {
<a name="l00209"></a>00209                 <span class="comment">//System.out.println(effList[positions[i]].getSavings());</span>
<a name="l00210"></a>00210 
<a name="l00211"></a>00211                 <span class="comment">// 3.1. Select the next edge from the list (either at random or not)</span>
<a name="l00212"></a>00212                 <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a> ijEdge = effList[positions[i]];
<a name="l00213"></a>00213 
<a name="l00214"></a>00214                 <span class="comment">// 3.2. Determine the nodes i &lt; j that define the edge</span>
<a name="l00215"></a>00215                 <a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html" title="This class represents a node in the VRP. A node could be a customer (delivery point)...">Node</a> iNode = ijEdge.<a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html#a3da9a044ba0a8416b49fb5b736c733f5" title="Get Starting Node.">getOrigin</a>();
<a name="l00216"></a>00216                 <a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html" title="This class represents a node in the VRP. A node could be a customer (delivery point)...">Node</a> jNode = ijEdge.<a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html#acedbf7f3eb08bdccb0a5ad399c025311" title="Get Ending Node.">getEnd</a>();
<a name="l00217"></a>00217  
<a name="l00218"></a>00218                 <span class="comment">// 3.3. Determine the routes associated to each node</span>
<a name="l00219"></a>00219                 <span class="comment">//Route iR = getRoute(iNode, aSolution);</span>
<a name="l00220"></a>00220                 <span class="comment">//Route jR = getRoute(jNode, aSolution);</span>
<a name="l00221"></a>00221                 <a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html" title="This class represents a route (array of edges) of a VRP instance.">Route</a> iR = iNode.<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html#a2aeb3e3ed37a1bb1d18ccc265a1b9f57" title="Gets the route instance which the node is associated.">getRoute</a>();
<a name="l00222"></a>00222                 <a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html" title="This class represents a route (array of edges) of a VRP instance.">Route</a> jR = jNode.<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html#a2aeb3e3ed37a1bb1d18ccc265a1b9f57" title="Gets the route instance which the node is associated.">getRoute</a>();
<a name="l00223"></a>00223 
<a name="l00224"></a>00224                 <span class="comment">// 3.4. If all necessary conditions are satisfied, apply merging process</span>
<a name="l00225"></a>00225                 <span class="comment">// boolean isMergingPossible = checkMergingConditions(iR, jR, ijEdge, aTest);</span>
<a name="l00226"></a>00226                 <span class="comment">// 3.4. If all necessary conditions are satisfied, apply merging process with diferents vehicles</span>
<a name="l00227"></a>00227                 <span class="keywordflow">if</span> (<a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a23d556c6faad3f76242a8d1d8651d7b2" title="Check if it is feasible to merge two given routes.">checkMergingConditions</a>(iR, jR, ijEdge, test)) 
<a name="l00228"></a>00228                 {
<a name="l00229"></a>00229                         aSolution.<a class="code" href="../../d9/dfd/classsrgcwscs_1_1_solution.html#a9ed4f115ce02e47dcf4f85272de89219" title="Remove a given route costs to the global solution cost.">substractCosts</a>(iR);
<a name="l00230"></a>00230                         aSolution.<a class="code" href="../../d9/dfd/classsrgcwscs_1_1_solution.html#a9ed4f115ce02e47dcf4f85272de89219" title="Remove a given route costs to the global solution cost.">substractCosts</a>(jR);
<a name="l00231"></a>00231 
<a name="l00232"></a>00232                         <span class="comment">// 3.4.1. Get an edge iE in iR containing nodes i and 0</span>
<a name="l00233"></a>00233                         <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a> iE = <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a70e61fc97af8dc5801be5c2dd9f38983" title="Gets the edge directly connected to the depot.">getEdgeDepotNode</a>(iR, iNode);<span class="comment">// iE is either (0,i) or (i,0)</span>
<a name="l00234"></a>00234                         <span class="comment">// 3.4.2. Get an edge jE in jR containing nodes j and 0</span>
<a name="l00235"></a>00235                         <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a> jE = <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a70e61fc97af8dc5801be5c2dd9f38983" title="Gets the edge directly connected to the depot.">getEdgeDepotNode</a>(jR, jNode); <span class="comment">// jE is either (0,j) or (j,0)</span>
<a name="l00236"></a>00236 
<a name="l00237"></a>00237                         <span class="comment">// 3.4.3. Remove edge iE from iR route </span>
<a name="l00238"></a>00238                         iR.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#afa1fc7be16768dae22d7e61ca5d0b2ec" title="Get route edges.">getEdges</a>().remove(iE);
<a name="l00239"></a>00239                         iR.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#a8f24d7d060487d00139ce3cc6345b719" title="Remove edge cost from total route cost.">substractCosts</a>(iE);
<a name="l00240"></a>00240                         
<a name="l00241"></a>00241                         <span class="comment">// 3.4.4. Remove edge jE from jR route</span>
<a name="l00242"></a>00242                         jR.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#afa1fc7be16768dae22d7e61ca5d0b2ec" title="Get route edges.">getEdges</a>().remove(jE);
<a name="l00243"></a>00243                         jR.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#a8f24d7d060487d00139ce3cc6345b719" title="Remove edge cost from total route cost.">substractCosts</a>(jE);
<a name="l00244"></a>00244 
<a name="l00245"></a>00245                         <span class="comment">// 3.4.5. If there are more than one edge then i will be interior</span>
<a name="l00246"></a>00246                         <span class="keywordflow">if</span> (iR.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#afa1fc7be16768dae22d7e61ca5d0b2ec" title="Get route edges.">getEdges</a>().size() &gt; 1) 
<a name="l00247"></a>00247                         {
<a name="l00248"></a>00248                                 iNode.<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html#af84328552840115a9c89f2e8864eeabe" title="Updates the nodes status in the route.">setIsInterior</a>(<span class="keyword">true</span>);
<a name="l00249"></a>00249                         }
<a name="l00250"></a>00250                         
<a name="l00251"></a>00251                         <span class="comment">// 3.4.6. If there are more than one edge then j will be interior</span>
<a name="l00252"></a>00252                         <span class="keywordflow">if</span> (jR.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#afa1fc7be16768dae22d7e61ca5d0b2ec" title="Get route edges.">getEdges</a>().size() &gt; 1) 
<a name="l00253"></a>00253                         {
<a name="l00254"></a>00254                                 jNode.<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html#af84328552840115a9c89f2e8864eeabe" title="Updates the nodes status in the route.">setIsInterior</a>(<span class="keyword">true</span>);
<a name="l00255"></a>00255                         }
<a name="l00256"></a>00256                         
<a name="l00257"></a>00257                         <span class="comment">//3.4.7 Control routes and edges in order to merge it properly</span>
<a name="l00258"></a>00258                         <span class="comment">//mergingManager(iR,jR,ijEdge,aSolution);</span>
<a name="l00259"></a>00259                         <span class="keywordflow">if</span>(iR.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#afa1fc7be16768dae22d7e61ca5d0b2ec" title="Get route edges.">getEdges</a>().size() &gt; jR.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#afa1fc7be16768dae22d7e61ca5d0b2ec" title="Get route edges.">getEdges</a>().size())
<a name="l00260"></a>00260                         {
<a name="l00261"></a>00261                                 <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#aab6184c895f6d718e5e1e1bb88361949" title="Coordinates the merging process, reduces the timing used for coordinates routes and...">mergingManager</a>(iR,jR,ijEdge,aSolution);
<a name="l00262"></a>00262                         }
<a name="l00263"></a>00263                         <span class="keywordflow">else</span>
<a name="l00264"></a>00264                         {
<a name="l00265"></a>00265                                 
<a name="l00266"></a>00266                                 <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a> ijNewEdge = <span class="keyword">new</span> <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a> (ijEdge);
<a name="l00267"></a>00267                                 ijNewEdge.<a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html#a59c921d9d7b2ca5337d0996b1d6a0199" title="Reverse the edge, starting and ending nodes are swapped.">reverse</a>();
<a name="l00268"></a>00268                                 <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#aab6184c895f6d718e5e1e1bb88361949" title="Coordinates the merging process, reduces the timing used for coordinates routes and...">mergingManager</a>(jR,iR,ijNewEdge,aSolution);
<a name="l00269"></a>00269                         }
<a name="l00270"></a>00270                         
<a name="l00271"></a>00271                         <span class="comment">//System.out.println(currentSol.getCosts());</span>
<a name="l00272"></a>00272 
<a name="l00273"></a>00273                 }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275         }
<a name="l00276"></a>00276         
<a name="l00277"></a>00277         
<a name="l00278"></a>00278     }
<a name="l00279"></a>00279     
<a name="l00293"></a><a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a70e61fc97af8dc5801be5c2dd9f38983">00293</a>     <span class="keyword">public</span> <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a> <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a70e61fc97af8dc5801be5c2dd9f38983" title="Gets the edge directly connected to the depot.">getEdgeDepotNode</a>(<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html" title="This class represents a route (array of edges) of a VRP instance.">Route</a> aRoute, <a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html" title="This class represents a node in the VRP. A node could be a customer (delivery point)...">Node</a> externalNode) 
<a name="l00294"></a>00294     {
<a name="l00295"></a>00295         <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a> noEdge = null;
<a name="l00296"></a>00296         
<a name="l00297"></a>00297         <span class="comment">//1. Try to get first edge</span>
<a name="l00298"></a>00298         <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a> depotStart = aRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#afa1fc7be16768dae22d7e61ca5d0b2ec" title="Get route edges.">getEdges</a>().get(0);
<a name="l00299"></a>00299         <span class="keywordtype">int</span> idEnd = depotStart.<a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html#acedbf7f3eb08bdccb0a5ad399c025311" title="Get Ending Node.">getEnd</a>().<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html#a40d2d8ebcffb786c3b353b87108611da" title="Gets the nodes identification.">getId</a>(); 
<a name="l00300"></a>00300         
<a name="l00301"></a>00301         <span class="keywordflow">if</span>(idEnd == externalNode.<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html#a40d2d8ebcffb786c3b353b87108611da" title="Gets the nodes identification.">getId</a>())
<a name="l00302"></a>00302         {
<a name="l00303"></a>00303                 <span class="keywordflow">return</span> depotStart;
<a name="l00304"></a>00304         }
<a name="l00305"></a>00305         
<a name="l00306"></a>00306         <span class="comment">//2. Try to get last edge</span>
<a name="l00307"></a>00307         <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a> endDepot = aRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#afa1fc7be16768dae22d7e61ca5d0b2ec" title="Get route edges.">getEdges</a>().get(aRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#afa1fc7be16768dae22d7e61ca5d0b2ec" title="Get route edges.">getEdges</a>().size() -1);
<a name="l00308"></a>00308         <span class="keywordtype">int</span> idStart = endDepot.<a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html#a3da9a044ba0a8416b49fb5b736c733f5" title="Get Starting Node.">getOrigin</a>().<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html#a40d2d8ebcffb786c3b353b87108611da" title="Gets the nodes identification.">getId</a>(); 
<a name="l00309"></a>00309         
<a name="l00310"></a>00310         <span class="keywordflow">if</span>(idStart == externalNode.<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html#a40d2d8ebcffb786c3b353b87108611da" title="Gets the nodes identification.">getId</a>())
<a name="l00311"></a>00311         {
<a name="l00312"></a>00312                 <span class="keywordflow">return</span> endDepot;
<a name="l00313"></a>00313         }
<a name="l00314"></a>00314 
<a name="l00315"></a>00315         <span class="comment">// If no edge has been found, send a warning message</span>
<a name="l00316"></a>00316         System.out.println(<span class="stringliteral">&quot;Error in getEdgeDepotNode() method: no edge was found&quot;</span>);
<a name="l00317"></a>00317         <span class="keywordflow">return</span> noEdge;
<a name="l00318"></a>00318     }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     
<a name="l00330"></a><a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a404ed42a0fa6570378a855e837838b5f">00330</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a404ed42a0fa6570378a855e837838b5f" title="Reverse the route direction, reversing all edges in route.">reverseRoute</a>(<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html" title="This class represents a route (array of edges) of a VRP instance.">Route</a> aRoute) 
<a name="l00331"></a>00331     {
<a name="l00332"></a>00332         <a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html" title="This class represents a route (array of edges) of a VRP instance.">Route</a> auxRoute = <span class="keyword">new</span> <a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html" title="This class represents a route (array of edges) of a VRP instance.">Route</a>();
<a name="l00333"></a>00333         
<a name="l00334"></a>00334         <span class="comment">// For each ijEdge in aRoute, reverse the edge</span>
<a name="l00335"></a>00335         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = aRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#afa1fc7be16768dae22d7e61ca5d0b2ec" title="Get route edges.">getEdges</a>().size() - 1; i &gt;= 0; i--) 
<a name="l00336"></a>00336         {
<a name="l00337"></a>00337                 <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a> newEdge = <span class="keyword">new</span> <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a> (aRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#afa1fc7be16768dae22d7e61ca5d0b2ec" title="Get route edges.">getEdges</a>().get(i));
<a name="l00338"></a>00338                 newEdge.<a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html#a59c921d9d7b2ca5337d0996b1d6a0199" title="Reverse the edge, starting and ending nodes are swapped.">reverse</a>();
<a name="l00339"></a>00339                 auxRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#aae3669c12cbb8e896b444e66928a7b32" title="Adds a new edge to he route.">addEdge</a>(newEdge);
<a name="l00340"></a>00340         }
<a name="l00341"></a>00341         
<a name="l00342"></a>00342         aRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#aa4d6f20b8a48346cbfefb2238ae95c28" title="Sets a new list of edges and nodes.">setEdges</a>(auxRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#afa1fc7be16768dae22d7e61ca5d0b2ec" title="Get route edges.">getEdges</a>(), auxRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#ae59d4e063f8c4d881b7d488c59e369c4" title="Get route nodes.">getNodes</a>());
<a name="l00343"></a>00343     }
<a name="l00344"></a>00344 
<a name="l00360"></a><a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#aab6184c895f6d718e5e1e1bb88361949">00360</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#aab6184c895f6d718e5e1e1bb88361949" title="Coordinates the merging process, reduces the timing used for coordinates routes and...">mergingManager</a>(<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html" title="This class represents a route (array of edges) of a VRP instance.">Route</a> bigRoute,<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html" title="This class represents a route (array of edges) of a VRP instance.">Route</a> smallRoute,<a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a> newEdge,<a class="code" href="../../d9/dfd/classsrgcwscs_1_1_solution.html" title="This class represents a solution (array of routes) of a VRP instance.">Solution</a> aSolution)
<a name="l00361"></a>00361     {
<a name="l00362"></a>00362         <span class="comment">// 1. If new big route does not start at 0</span>
<a name="l00363"></a>00363                 <span class="keywordflow">if</span> (bigRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#afa1fc7be16768dae22d7e61ca5d0b2ec" title="Get route edges.">getEdges</a>().get(0).getOrigin().getId() != 0) 
<a name="l00364"></a>00364                 {
<a name="l00365"></a>00365                         <span class="comment">//1.1.1 newEdge is reversed in order to have the same direction of the big route</span>
<a name="l00366"></a>00366                         <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a> reverseNewEdge = <span class="keyword">new</span> <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a> (newEdge);
<a name="l00367"></a>00367                         reverseNewEdge.<a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html#a59c921d9d7b2ca5337d0996b1d6a0199" title="Reverse the edge, starting and ending nodes are swapped.">reverse</a>();
<a name="l00368"></a>00368                         
<a name="l00369"></a>00369                         <span class="comment">//1.1.2 If new small route does start at 0 it must be reversed to have the same direction like the big route</span>
<a name="l00370"></a>00370                         <span class="keywordflow">if</span> (smallRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#afa1fc7be16768dae22d7e61ca5d0b2ec" title="Get route edges.">getEdges</a>().get(0).getOrigin().getId() != 0) 
<a name="l00371"></a>00371                         {
<a name="l00372"></a>00372                                 <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a404ed42a0fa6570378a855e837838b5f" title="Reverse the route direction, reversing all edges in route.">reverseRoute</a>(smallRoute);
<a name="l00373"></a>00373                         }
<a name="l00374"></a>00374                         
<a name="l00375"></a>00375                         <span class="comment">//1.1.3 Merge Routes</span>
<a name="l00376"></a>00376                         <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a2452350902ea0200d5acf77ac75e7523" title="Merge to given routes in a solution through an edge.">mergeRoutes</a>(smallRoute, bigRoute, reverseNewEdge,  aSolution);
<a name="l00377"></a>00377             }
<a name="l00378"></a>00378                 <span class="keywordflow">else</span>
<a name="l00379"></a>00379                 {
<a name="l00380"></a>00380                         <span class="comment">// 1.2.1 If new small route does start at 0 it must be reversed to have the same direction like the big one</span>
<a name="l00381"></a>00381                         <span class="keywordflow">if</span> (smallRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#afa1fc7be16768dae22d7e61ca5d0b2ec" title="Get route edges.">getEdges</a>().get(0).getOrigin().getId() == 0) 
<a name="l00382"></a>00382                         {
<a name="l00383"></a>00383                                 <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a404ed42a0fa6570378a855e837838b5f" title="Reverse the route direction, reversing all edges in route.">reverseRoute</a>(smallRoute);
<a name="l00384"></a>00384                         }
<a name="l00385"></a>00385                         
<a name="l00386"></a>00386                         <span class="comment">//1.2.2 Merge Routes</span>
<a name="l00387"></a>00387                         <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a2452350902ea0200d5acf77ac75e7523" title="Merge to given routes in a solution through an edge.">mergeRoutes</a>(bigRoute, smallRoute, newEdge,  aSolution);
<a name="l00388"></a>00388                 }
<a name="l00389"></a>00389     }
<a name="l00390"></a>00390     
<a name="l00391"></a>00391     
<a name="l00405"></a><a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a2452350902ea0200d5acf77ac75e7523">00405</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a2452350902ea0200d5acf77ac75e7523" title="Merge to given routes in a solution through an edge.">mergeRoutes</a>(<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html" title="This class represents a route (array of edges) of a VRP instance.">Route</a> finalRoute, <a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html" title="This class represents a route (array of edges) of a VRP instance.">Route</a> auxRoute, <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a> edge, <a class="code" href="../../d9/dfd/classsrgcwscs_1_1_solution.html" title="This class represents a solution (array of routes) of a VRP instance.">Solution</a> aSolution)
<a name="l00406"></a>00406     {
<a name="l00407"></a>00407         <span class="comment">//1. Add edge</span>
<a name="l00408"></a>00408         finalRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#aae3669c12cbb8e896b444e66928a7b32" title="Adds a new edge to he route.">addEdge</a>(edge);
<a name="l00409"></a>00409         finalRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#af01e70b1d49f730cd34fc2cb6817b104" title="add Edge demand to the total route demand">addDemand</a>(edge);
<a name="l00410"></a>00410         finalRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#a85bf0163875818ca04db252cbdad766d" title="Updates route cost add an edge cost.">addCosts</a>(edge);
<a name="l00411"></a>00411         edge.<a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html#a3da9a044ba0a8416b49fb5b736c733f5" title="Get Starting Node.">getOrigin</a>().<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html#a32b8133c3d39f06e2f76cf10a5b1b43f" title="Updates route identification associated to the node.">setInRoute</a>(finalRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#a9dcc9ef4ad8b28571f395821fcd1a901" title="Get route identification.">getId</a>());
<a name="l00412"></a>00412         edge.<a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html#a3da9a044ba0a8416b49fb5b736c733f5" title="Get Starting Node.">getOrigin</a>().<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html#a5c484c1e76a4a1d327dc2d6d2f9e5719" title="Updates the route instance associated to the node.">setRoute</a>(finalRoute);
<a name="l00413"></a>00413         
<a name="l00414"></a>00414         <span class="comment">//2. Merge Routes</span>
<a name="l00415"></a>00415         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; auxRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#afa1fc7be16768dae22d7e61ca5d0b2ec" title="Get route edges.">getEdges</a>().size(); k++) 
<a name="l00416"></a>00416         {
<a name="l00417"></a>00417                 <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a> kEdge = auxRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#afa1fc7be16768dae22d7e61ca5d0b2ec" title="Get route edges.">getEdges</a>().get(k);
<a name="l00418"></a>00418                 finalRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#aae3669c12cbb8e896b444e66928a7b32" title="Adds a new edge to he route.">addEdge</a>(kEdge);
<a name="l00419"></a>00419                 finalRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#af01e70b1d49f730cd34fc2cb6817b104" title="add Edge demand to the total route demand">addDemand</a>(kEdge);
<a name="l00420"></a>00420                 finalRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#a85bf0163875818ca04db252cbdad766d" title="Updates route cost add an edge cost.">addCosts</a>(kEdge);
<a name="l00421"></a>00421                 kEdge.<a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html#acedbf7f3eb08bdccb0a5ad399c025311" title="Get Ending Node.">getEnd</a>().<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html#a32b8133c3d39f06e2f76cf10a5b1b43f" title="Updates route identification associated to the node.">setInRoute</a>(finalRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#a9dcc9ef4ad8b28571f395821fcd1a901" title="Get route identification.">getId</a>());
<a name="l00422"></a>00422                 <span class="comment">//Marcos added</span>
<a name="l00423"></a>00423                 kEdge.<a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html#a3da9a044ba0a8416b49fb5b736c733f5" title="Get Starting Node.">getOrigin</a>().<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html#a32b8133c3d39f06e2f76cf10a5b1b43f" title="Updates route identification associated to the node.">setInRoute</a>(finalRoute.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#a9dcc9ef4ad8b28571f395821fcd1a901" title="Get route identification.">getId</a>());
<a name="l00424"></a>00424                 
<a name="l00425"></a>00425                 kEdge.<a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html#acedbf7f3eb08bdccb0a5ad399c025311" title="Get Ending Node.">getEnd</a>().<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html#a5c484c1e76a4a1d327dc2d6d2f9e5719" title="Updates the route instance associated to the node.">setRoute</a>(finalRoute);
<a name="l00426"></a>00426                 kEdge.<a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html#a3da9a044ba0a8416b49fb5b736c733f5" title="Get Starting Node.">getOrigin</a>().<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html#a5c484c1e76a4a1d327dc2d6d2f9e5719" title="Updates the route instance associated to the node.">setRoute</a>(finalRoute);
<a name="l00427"></a>00427         }
<a name="l00428"></a>00428     
<a name="l00429"></a>00429         <span class="comment">//3. Delete route jR from iterSolution</span>
<a name="l00430"></a>00430         aSolution.<a class="code" href="../../d9/dfd/classsrgcwscs_1_1_solution.html#ad1eb86c5a8e80359c172a4999c483521" title="Gets the array list of routes for the global solution.">getRoutes</a>().remove(auxRoute);
<a name="l00431"></a>00431         aSolution.<a class="code" href="../../d9/dfd/classsrgcwscs_1_1_solution.html#a38510d99d0f518df6541c8589f9589dd" title="Adds a given route costs to the global solution cost.">addCosts</a>(finalRoute);
<a name="l00432"></a>00432         
<a name="l00433"></a>00433     }
<a name="l00434"></a>00434         
<a name="l00435"></a>00435 
<a name="l00454"></a><a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a23d556c6faad3f76242a8d1d8651d7b2">00454</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a23d556c6faad3f76242a8d1d8651d7b2" title="Check if it is feasible to merge two given routes.">checkMergingConditions</a>(<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html" title="This class represents a route (array of edges) of a VRP instance.">Route</a> iR, <a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html" title="This class represents a route (array of edges) of a VRP instance.">Route</a> jR, <a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html" title="This class represents an edge connecting two nodes in the VRP.">Edge</a> ijEdge,<a class="code" href="../../db/d24/classsrgcwscs_1_1_test.html" title="This class represents a test to be run. A test has a set of properties related to...">Test</a> atest) 
<a name="l00455"></a>00455     {
<a name="l00456"></a>00456         <span class="comment">// Condition 1: iR and jR are not the same route</span>
<a name="l00457"></a>00457         <span class="keywordflow">if</span>( iR.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#a9dcc9ef4ad8b28571f395821fcd1a901" title="Get route identification.">getId</a>() == jR.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#a9dcc9ef4ad8b28571f395821fcd1a901" title="Get route identification.">getId</a>() )
<a name="l00458"></a>00458         {
<a name="l00459"></a>00459                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00460"></a>00460         }
<a name="l00461"></a>00461         
<a name="l00462"></a>00462         <span class="comment">// Condition 2: both nodes are exterior nodes in their respective routes</span>
<a name="l00463"></a>00463         <span class="keywordflow">if</span>( ijEdge.<a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html#a3da9a044ba0a8416b49fb5b736c733f5" title="Get Starting Node.">getOrigin</a>().<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html#ade3d1003ea2236994955f63e6592ee8b" title="Node interior -&amp;gt; no direct connection with depot.">isInterior</a>() == <span class="keyword">true</span> || ijEdge.<a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html#acedbf7f3eb08bdccb0a5ad399c025311" title="Get Ending Node.">getEnd</a>().<a class="code" href="../../df/d12/classsrgcwscs_1_1_node.html#ade3d1003ea2236994955f63e6592ee8b" title="Node interior -&amp;gt; no direct connection with depot.">isInterior</a>() == true )
<a name="l00464"></a>00464         {
<a name="l00465"></a>00465                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00466"></a>00466         }
<a name="l00467"></a>00467         
<a name="l00468"></a>00468         <span class="comment">// Condition 3: demand after merging can be covered by a single vehicle</span>
<a name="l00469"></a>00469         <span class="keywordflow">if</span> (iR.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#a025c39ca31758149948534e9dc087272" title="Get route demand.">getDemand</a>() + jR.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#a025c39ca31758149948534e9dc087272" title="Get route demand.">getDemand</a>() &gt; <a class="code" href="../../da/d9f/classsrgcwscs_1_1_rand_c_w_s.html#a3f7c99984dba7e69a130aa27e6de4967" title="Inputs a representation of the different components of the problem, nodes, edges...">inputs</a>.<a class="code" href="../../d4/d46/classsrgcwscs_1_1_inputs.html#aaf4239bef28ba35b08a2f4fe678599f2" title="Gets a vehicle stored in a given position of the array list of available vehicles...">getVehicle</a>(0).<a class="code" href="../../d2/d00/classsrgcwscs_1_1_vehicle.html#ae05dda2b37c525ae80bc761f88a52d28" title="Gets vehicle capacity.">getVcap</a>())
<a name="l00470"></a>00470         {
<a name="l00471"></a>00471                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00472"></a>00472         }
<a name="l00473"></a>00473         
<a name="l00474"></a>00474         <span class="comment">// Condition 4: total costs (distance) after merging are feasible</span>
<a name="l00475"></a>00475         <span class="keywordtype">int</span> nodesInIR = iR.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#ae59d4e063f8c4d881b7d488c59e369c4" title="Get route nodes.">getNodes</a>().size();
<a name="l00476"></a>00476         <span class="keywordtype">int</span> nodesInJR = jR.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#ae59d4e063f8c4d881b7d488c59e369c4" title="Get route nodes.">getNodes</a>().size();
<a name="l00477"></a>00477         <span class="keywordflow">if</span> ( (iR.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#af1ea691dca6fa0e86f69b37cd88835a3" title="Get route costs.">getCosts</a>() + jR.<a class="code" href="../../df/d82/classsrgcwscs_1_1_route.html#af1ea691dca6fa0e86f69b37cd88835a3" title="Get route costs.">getCosts</a>() - ijEdge.<a class="code" href="../../df/d5c/classsrgcwscs_1_1_edge.html#a6caef062fe22dbd73c76de11d74fffd6" title="Get Edge Savings value.">getSavings</a>()) &gt; (atest.<a class="code" href="../../db/d24/classsrgcwscs_1_1_test.html#a77770c42ed1c15ecb00d2a2348b05108" title="Gets maximum route costs.">getMaxRouteCost</a>() - atest.<a class="code" href="../../db/d24/classsrgcwscs_1_1_test.html#adcefeef4ab146d99c6d01132d50f63d7" title="Gets Service Costs.">getServiceCosts</a>() * (nodesInIR + nodesInJR - 2)))
<a name="l00478"></a>00478         {
<a name="l00479"></a>00479                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00480"></a>00480         }
<a name="l00481"></a>00481 
<a name="l00482"></a>00482         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00483"></a>00483     }
<a name="l00484"></a>00484 
<a name="l00485"></a>00485     
<a name="l00486"></a>00486 }
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Sun Jan 13 16:55:37 2013 for Clarke and Wright with Monte Carlo Simulation Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
